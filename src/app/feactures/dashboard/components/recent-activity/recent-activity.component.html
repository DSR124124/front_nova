<div class="recent-activity-container">
  <!-- Botón trigger minimalista -->
  <div class="activity-trigger">
    <p-button
      icon="pi pi-list"
      [outlined]="true"
      size="small"
      (onClick)="showDrawer = true"
      class="activity-trigger-btn"
      pTooltip="Actividad Reciente"
    />
    <span *ngIf="activities.length > 0" class="activity-badge">{{ activities.length }}</span>
  </div>

  <!-- Drawer optimizado -->
  <p-drawer
    [(visible)]="showDrawer"
    position="right"
    [modal]="false"
    [showCloseIcon]="true"
    styleClass="activity-drawer"
    [style]="{width: '380px'}"
  >
    <ng-template pTemplate="header">
      <div class="drawer-header">
        <h3 class="text-xl font-semibold text-900">Actividad Reciente</h3>
        <div class="header-actions">
          <p-button
            icon="pi pi-refresh"
            [text]="true"
            [rounded]="true"
            size="small"
            (onClick)="refreshActivities()"
            [loading]="loading"
            pTooltip="Actualizar"
          />
          <p-button
            icon="pi pi-trash"
            [text]="true"
            [rounded]="true"
            size="small"
            severity="secondary"
            (onClick)="clearActivities()"
            [disabled]="loading || activities.length === 0"
            pTooltip="Limpiar todo"
          />
        </div>
      </div>
    </ng-template>

    <ng-template pTemplate="content">
      <div class="activities-content">

        <!-- Estado de carga -->
        <div *ngIf="loading" class="loading-state text-center">
          <i class="pi pi-spin pi-spinner text-3xl text-primary mb-3"></i>
          <p class="text-600">Cargando actividades...</p>
        </div>

        <!-- Lista vacía -->
        <div *ngIf="!loading && activities.length === 0" class="empty-state text-center">
          <i class="pi pi-inbox text-4xl text-500 mb-3"></i>
          <p class="text-900 font-semibold mb-1">No hay actividad reciente</p>
          <small class="text-600">Las actividades aparecerán aquí cuando interactúes con la aplicación</small>
          <div class="mt-3">
            <p-button
              label="Actualizar"
              icon="pi pi-refresh"
              [outlined]="true"
              size="small"
              (onClick)="refreshActivities()"
            />
          </div>
        </div>

        <!-- Lista de actividades -->
        <div *ngIf="!loading && activities.length > 0" class="activities-list">
          <div
            *ngFor="let activity of activities; trackBy: trackByActivity"
            class="activity-item"
          >
            <div class="activity-icon">
              <i [class]="activity.icon" [class]="'icon-' + activity.type"></i>
            </div>

            <div class="activity-content">
              <div class="activity-header-item">
                <span class="activity-title text-900 font-medium">{{ activity.title }}</span>
                <div class="activity-meta">
                  <span
                    class="activity-tag"
                    [class]="'tag-' + activity.type"
                  >
                    {{ getActivityTypeLabel(activity.type) }}
                  </span>
                  <small class="activity-time text-600">{{ formatTimeAgo(activity.date) }}</small>
                </div>
              </div>

              <p class="activity-description text-600">{{ activity.description }}</p>

              <div *ngIf="activity.user" class="activity-user">
                <i class="pi pi-user text-500"></i>
                <span class="text-600">{{ activity.user }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Ver más -->
        <div *ngIf="!loading && activities.length >= 5" class="view-more text-center">
          <p-button
            label="Ver más actividades"
            icon="pi pi-angle-down"
            [text]="true"
            size="small"
            class="view-more-btn"
          />
        </div>

      </div>
    </ng-template>
  </p-drawer>
</div>
