<div class="upcoming-events-container">
  <!-- Botón trigger minimalista -->
  <div class="events-trigger">
    <p-button
      icon="pi pi-calendar-plus"
      label="Próximos Eventos"
      [outlined]="true"
      size="small"
      (onClick)="drawerVisible = true"
      class="events-trigger-btn"
    />
    <span *ngIf="events.length > 0" class="events-badge">{{ events.length }}</span>
  </div>

  <!-- Drawer optimizado -->
  <p-drawer
    [(visible)]="drawerVisible"
    position="right"
    [modal]="false"
    [showCloseIcon]="true"
    styleClass="events-drawer"
    [style]="{width: '380px'}"
  >
    <ng-template pTemplate="header">
      <div class="drawer-header">
        <h3 class="text-xl font-semibold text-900">Próximos Eventos</h3>
        <div class="header-actions">
          <p-button
            icon="pi pi-refresh"
            [text]="true"
            [rounded]="true"
            size="small"
            (onClick)="refreshEvents()"
            [loading]="loading"
            pTooltip="Actualizar"
          />
          <p-button
            icon="pi pi-plus"
            [text]="true"
            [rounded]="true"
            size="small"
            severity="success"
            (onClick)="createEvent()"
            pTooltip="Crear evento"
          />
        </div>
      </div>
    </ng-template>

    <ng-template pTemplate="content">
      <div class="events-content">

        <!-- Estado de carga -->
        <div *ngIf="loading" class="loading-state text-center">
          <i class="pi pi-spin pi-spinner text-3xl text-primary mb-3"></i>
          <p class="text-600">Cargando eventos...</p>
        </div>

        <!-- Lista vacía -->
        <div *ngIf="!loading && events.length === 0" class="empty-state text-center">
          <i class="pi pi-calendar-plus text-4xl text-500 mb-3"></i>
          <p class="text-900 font-semibold mb-1">No hay eventos próximos</p>
          <small class="text-600">Tus próximos eventos aparecerán aquí</small>
          <div class="mt-3">
            <p-button
              label="Crear Evento"
              icon="pi pi-plus"
              [outlined]="true"
              size="small"
              (onClick)="createEvent()"
            />
          </div>
        </div>

        <!-- Lista de eventos -->
        <div *ngIf="!loading && events.length > 0" class="events-list">
          <div
            *ngFor="let event of events; trackBy: trackByEvent"
            class="event-item"
            (click)="viewEventDetails(event)"
          >
            <div class="event-icon">
              <i [class]="event.icon" [class]="'icon-' + event.category"></i>
            </div>

            <div class="event-content">
              <div class="event-header-item">
                <span class="event-title text-900 font-medium">{{ event.title }}</span>
                <div class="event-meta">
                  <span
                    class="event-tag"
                    [class]="'tag-' + event.category"
                  >
                    {{ getCategoryLabel(event.category) }}
                  </span>
                  <small class="event-time text-600">{{ formatTimeUntil(event.date) }}</small>
                </div>
              </div>

              <p class="event-description text-600">{{ event.description }}</p>

              <div class="event-details">
                <div *ngIf="event.location" class="event-location">
                  <i class="pi pi-map-marker text-500"></i>
                  <span class="text-600">{{ event.location }}</span>
                </div>
                <div class="event-priority">
                  <i [class]="getPriorityIcon(event.priority)" class="text-500"></i>
                  <span class="text-600">{{ event.priority }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ver más -->
        <div *ngIf="!loading && events.length >= maxEvents" class="view-more text-center">
          <p-button
            label="Ver todos los eventos"
            icon="pi pi-angle-down"
            [text]="true"
            size="small"
            (onClick)="viewAllEvents()"
            class="view-more-btn"
          />
        </div>

      </div>
    </ng-template>
  </p-drawer>
</div>
