<div class="evento-timeline-container">

  <!-- Header -->
  <div class="timeline-header">
    <h2 class="timeline-title">
      <i class="pi pi-clock"></i>
      Línea de Tiempo de Eventos
    </h2>
    <p class="timeline-subtitle">Visualiza tus eventos en orden cronológico</p>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-state">
    <i class="pi pi-spin pi-spinner loading-icon"></i>
    <p>Cargando línea de tiempo...</p>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="!loading" class="timeline-content">

    <!-- Controles y filtros -->
    <p-card header="Filtros y Vista" styleClass="filters-card">
      <div class="filters-grid">

        <!-- Búsqueda -->
        <div class="filter-section">
          <label class="filter-label">Buscar eventos</label>
          <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input
              type="text"
              pInputText
              placeholder="Buscar por título, descripción..."
              [(ngModel)]="searchTerm"
              (input)="onSearchChange()"
              class="filter-input"
            />
          </span>
        </div>

        <!-- Filtro por tipo -->
        <div class="filter-section">
          <label class="filter-label">Tipo de evento</label>
          <p-select
            [options]="tipoOptions"
            [(ngModel)]="selectedTipo"
            (onChange)="onTipoChange()"
            placeholder="Todos los tipos"
            styleClass="filter-input"
          />
        </div>

        <!-- Filtro por período -->
        <div class="filter-section">
          <label class="filter-label">Período</label>
          <p-select
            [options]="periodoOptions"
            [(ngModel)]="selectedPeriodo"
            (onChange)="onPeriodoChange()"
            placeholder="Todos los períodos"
            styleClass="filter-input"
          />
        </div>

        <!-- Botón limpiar filtros -->
        <div class="filter-section">
          <label class="filter-label">&nbsp;</label>
          <p-button
            label="Limpiar filtros"
            icon="pi pi-refresh"
            severity="secondary"
            [outlined]="true"
            (onClick)="limpiarFiltros()"
          />
        </div>

      </div>
    </p-card>

    <!-- Información de resultados -->
    <div class="results-info">
      <span class="results-text">
        Mostrando {{ eventosFiltrados.length }} de {{ eventos.length }} eventos
      </span>
    </div>

    <!-- Timeline PrimeNG -->
    <div class="timeline-wrapper">
      <p-timeline
        [value]="getEventosAgrupados()"
        align="alternate"
        styleClass="custom-timeline"
      >
        <!-- Marcador personalizado -->
        <ng-template pTemplate="marker" let-event>
          <span
            class="timeline-marker-custom"
            [class.past]="getDiasRestantes(event.fecha) < 0"
            [class.today]="getDiasRestantes(event.fecha) === 0"
            [class.future]="getDiasRestantes(event.fecha) > 0"
          >
            <i class="pi" [class]="getTipoIcono(event.tipo)"></i>
          </span>
        </ng-template>

        <!-- Contenido del evento -->
        <ng-template pTemplate="content" let-event>
          <p-card styleClass="timeline-event-card">
            <ng-template pTemplate="header">
              <div class="card-header">
                <span class="evento-tipo-badge">
                  <i class="pi" [class]="getTipoIcono(event.tipo)"></i>
                  {{ event.tipo || 'EVENTO' }}
                </span>
                <div class="card-actions">
                  <p-button
                    icon="pi pi-eye"
                    severity="info"
                    size="small"
                    [text]="true"
                    (onClick)="verDetalle(event)"
                    pTooltip="Ver detalle"
                  />
                  <p-button
                    icon="pi pi-pencil"
                    severity="secondary"
                    size="small"
                    [text]="true"
                    (onClick)="editarEvento(event)"
                    pTooltip="Editar"
                  />
                  <p-button
                    icon="pi pi-trash"
                    severity="danger"
                    size="small"
                    [text]="true"
                    (onClick)="eliminarEvento(event)"
                    pTooltip="Eliminar"
                  />
                </div>
              </div>
            </ng-template>

            <div class="card-content">
              <h3 class="evento-titulo">{{ event.titulo }}</h3>
              <p *ngIf="event.descripcion" class="evento-descripcion">
                {{ event.descripcion }}
              </p>

              <div class="evento-details">
                <div class="detail-item">
                  <i class="pi pi-calendar"></i>
                  <span>{{ formatearFecha(event.fecha) }}</span>
                </div>
                <div class="detail-item">
                  <i class="pi pi-clock"></i>
                  <span>{{ formatearHora(event.fecha) }}</span>
                </div>
                <div class="detail-item" *ngIf="event.lugarNombre">
                  <i class="pi pi-map-marker"></i>
                  <span>{{ event.lugarNombre }}</span>
                </div>
              </div>

              <div class="evento-status">
                <span class="estado-badge" [class]="getEstadoCssClass(event.fecha)">
                  <i class="pi" [class]="getEstadoIcono(event.fecha)"></i>
                  {{ getEstadoTexto(event.fecha) }}
                </span>
                <span class="dias-restantes">{{ getDiasRestantesTexto(event.fecha) }}</span>
              </div>
            </div>
          </p-card>
        </ng-template>

        <!-- Fecha del evento (lado opuesto) -->
        <ng-template pTemplate="opposite" let-event>
          <div class="timeline-date">
            <div class="date-main">{{ formatearFecha(event.fecha) }}</div>
            <div class="date-time">{{ formatearHora(event.fecha) }}</div>
            <div class="date-status">{{ getDiasRestantesTexto(event.fecha) }}</div>
          </div>
        </ng-template>
      </p-timeline>

      <!-- Estado vacío -->
      <div *ngIf="eventosFiltrados.length === 0" class="empty-state">
        <i class="pi pi-clock empty-icon"></i>
        <h3 class="empty-title">No hay eventos en la línea de tiempo</h3>
        <p class="empty-text">
          {{ searchTerm || selectedTipo || selectedPeriodo ?
             'Intenta ajustar los filtros de búsqueda' :
             'Crea tu primer evento para comenzar' }}
        </p>
        <p-button
          *ngIf="!searchTerm && !selectedTipo && !selectedPeriodo"
          label="Crear primer evento"
          icon="pi pi-plus"
          (onClick)="crearEvento()"
        />
      </div>
    </div>

  </div>

  <!-- Diálogo de confirmación -->
  <p-confirmDialog></p-confirmDialog>

  <!-- Toast -->
  <p-toast position="top-right"></p-toast>

</div>
