<div class="evento-gallery-container">
  <p-card header="Galería de Eventos" styleClass="gallery-card">

    <!-- Loading Spinner -->
    <div *ngIf="loading" class="loading-container">
      <p-progressSpinner />
    </div>

    <!-- Contenido principal -->
    <div *ngIf="!loading">

      <!-- Filtros y controles -->
      <div class="gallery-controls">
        <!-- Búsqueda -->
        <div class="search-section">
          <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input
              type="text"
              pInputText
              placeholder="Buscar eventos..."
              [(ngModel)]="searchTerm"
              (input)="onSearchChange()"
              class="search-input"
            />
          </span>
        </div>

        <!-- Filtros -->
        <div class="filters-section">
          <p-dropdown
            [options]="tipoOptions"
            [(ngModel)]="selectedTipo"
            (onChange)="onTipoChange()"
            placeholder="Tipo de evento"
            styleClass="filter-dropdown"
          />

          <p-dropdown
            [options]="yearOptions"
            [(ngModel)]="selectedYear"
            (onChange)="onYearChange()"
            placeholder="Año"
            styleClass="filter-dropdown"
          />

          <p-button
            label="Limpiar filtros"
            icon="pi pi-refresh"
            severity="secondary"
            (onClick)="limpiarFiltros()"
            size="small"
          />
        </div>

        <!-- Cambio de vista -->
        <div class="view-controls">
          <p-button
            [icon]="viewMode === 'grid' ? 'pi pi-th-large' : 'pi pi-list'"
            [severity]="viewMode === 'grid' ? 'primary' : 'secondary'"
            (onClick)="cambiarVista('grid')"
            size="small"
            [pTooltip]="'Vista de cuadrícula'"
          />
          <p-button
            [icon]="viewMode === 'list' ? 'pi pi-th-large' : 'pi pi-list'"
            [severity]="viewMode === 'list' ? 'primary' : 'secondary'"
            (onClick)="cambiarVista('list')"
            size="small"
            [pTooltip]="'Vista de lista'"
          />
        </div>
      </div>

      <!-- Información de resultados -->
      <div class="results-info">
        <p>Mostrando {{ eventosFiltrados.length }} de {{ eventos.length }} eventos</p>
      </div>

      <!-- Galería de eventos -->
      <div class="gallery-content" [ngClass]="'view-' + viewMode">

        <!-- Vista de cuadrícula -->
        <div *ngIf="viewMode === 'grid'" class="grid-view">
          <div
            *ngFor="let evento of eventosPaginados"
            class="evento-card"
            [pTooltip]="evento.titulo"
          >
            <div class="evento-header">
              <p-tag
                [value]="evento.tipo || 'Evento'"
                [severity]="getTipoColor(evento.tipo)"
                [icon]="getTipoIcono(evento.tipo)"
                size="small"
              />
              <div class="evento-actions">
                <p-button
                  icon="pi pi-eye"
                  severity="info"
                  size="small"
                  (onClick)="verDetalle(evento)"
                  [pTooltip]="'Ver detalle'"
                />
                <p-button
                  icon="pi pi-pencil"
                  severity="warn"
                  size="small"
                  (onClick)="editarEvento(evento)"
                  [pTooltip]="'Editar'"
                />
                <p-button
                  icon="pi pi-trash"
                  severity="danger"
                  size="small"
                  (onClick)="eliminarEvento(evento)"
                  [pTooltip]="'Eliminar'"
                />
              </div>
            </div>

            <div class="evento-body">
              <h3 class="evento-titulo">{{ evento.titulo }}</h3>
              <p class="evento-descripcion" *ngIf="evento.descripcion">
                {{ evento.descripcion }}
              </p>

              <div class="evento-info">
                <div class="info-item">
                  <i class="pi pi-calendar"></i>
                  <span>{{ formatearFecha(evento.fecha) }}</span>
                </div>
                <div class="info-item">
                  <i class="pi pi-clock"></i>
                  <span>{{ formatearHora(evento.fecha) }}</span>
                </div>
                <div class="info-item" *ngIf="evento.lugarNombre">
                  <i class="pi pi-map-marker"></i>
                  <span>{{ evento.lugarNombre }}</span>
                </div>
              </div>

              <div class="evento-estado">
                <p-tag
                  [value]="getEstadoEvento(evento.fecha).texto"
                  [severity]="getEstadoEvento(evento.fecha).severity"
                  size="small"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Vista de lista -->
        <div *ngIf="viewMode === 'list'" class="list-view">
          <div
            *ngFor="let evento of eventosPaginados"
            class="evento-list-item"
          >
            <div class="evento-main-info">
              <div class="evento-tipo">
                <p-tag
                  [value]="evento.tipo || 'Evento'"
                  [severity]="getTipoColor(evento.tipo)"
                  [icon]="getTipoIcono(evento.tipo)"
                  size="small"
                />
              </div>

              <div class="evento-details">
                <h3 class="evento-titulo">{{ evento.titulo }}</h3>
                <p class="evento-descripcion" *ngIf="evento.descripcion">
                  {{ evento.descripcion }}
                </p>

                <div class="evento-meta">
                  <span class="meta-item">
                    <i class="pi pi-calendar"></i>
                    {{ formatearFecha(evento.fecha) }} a las {{ formatearHora(evento.fecha) }}
                  </span>
                  <span class="meta-item" *ngIf="evento.lugarNombre">
                    <i class="pi pi-map-marker"></i>
                    {{ evento.lugarNombre }}
                  </span>
                </div>
              </div>
            </div>

            <div class="evento-side-info">
              <div class="evento-estado">
                <p-tag
                  [value]="getEstadoEvento(evento.fecha).texto"
                  [severity]="getEstadoEvento(evento.fecha).severity"
                  size="small"
                />
              </div>

              <div class="evento-actions">
                <p-button
                  icon="pi pi-eye"
                  severity="info"
                  size="small"
                  (onClick)="verDetalle(evento)"
                  [pTooltip]="'Ver detalle'"
                />
                <p-button
                  icon="pi pi-pencil"
                  severity="secondary"
                  size="small"
                  (onClick)="editarEvento(evento)"
                  [pTooltip]="'Editar'"
                />
                <p-button
                  icon="pi pi-trash"
                  severity="danger"
                  size="small"
                  (onClick)="eliminarEvento(evento)"
                  [pTooltip]="'Eliminar'"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Estado vacío -->
        <div *ngIf="eventosFiltrados.length === 0" class="empty-state">
          <i class="pi pi-calendar-times empty-icon"></i>
          <h3>No se encontraron eventos</h3>
          <p>Intenta ajustar los filtros de búsqueda</p>
        </div>
      </div>

      <!-- Paginación -->
      <div *ngIf="totalPages > 1" class="pagination-section">
        <p-paginator
          [rows]="itemsPerPage"
          [totalRecords]="eventosFiltrados.length"
          [showPageLinks]="true"
          [showFirstLastIcon]="true"
        />
      </div>

    </div>

  </p-card>
</div>

<!-- Toast para mensajes -->
<p-toast />

<!-- Diálogo de confirmación -->
<p-confirmDialog />
