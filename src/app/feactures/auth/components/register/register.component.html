<p-card>
  <ng-template pTemplate="header">
    <div class="register-header">
      <h2>Crear Cuenta</h2>
      <p>Completa el formulario para registrarte</p>
    </div>
  </ng-template>

  <ng-template pTemplate="content">
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <!-- Nombres -->
      <div class="form-row">
        <div class="form-field">
          <p-floatlabel>
            <input
              pInputText
              id="nombre"
              formControlName="nombre"
            />
            <label for="nombre">Nombre</label>
          </p-floatlabel>
          <small
            *ngIf="isFieldInvalid('nombre')"
            class="simplified-error"
          >
            {{ getFieldError('nombre') }}
          </small>
        </div>

        <div class="form-field">
          <p-floatlabel>
            <input
              pInputText
              id="apellido"
              formControlName="apellido"
            />
            <label for="apellido">Apellido</label>
          </p-floatlabel>
          <small
            *ngIf="isFieldInvalid('apellido')"
            class="simplified-error"
          >
            {{ getFieldError('apellido') }}
          </small>
        </div>
      </div>

      <!-- Email -->
      <div class="form-field">
                <p-floatlabel>
          <input
            pInputText
            id="correo"
            formControlName="correo"
            type="email"
          />
          <label for="correo">Correo Electrónico</label>
        </p-floatlabel>
        <small
          *ngIf="isFieldInvalid('correo')"
          class="simplified-error"
        >
          {{ getFieldError('correo') }}
        </small>
      </div>

      <!-- Usuario -->
      <div class="form-field">
                <p-floatlabel>
          <input
            pInputText
            id="username"
            formControlName="username"
          />
          <label for="username">Nombre de Usuario</label>
        </p-floatlabel>
        <small
          *ngIf="isFieldInvalid('username')"
          class="simplified-error"
        >
          {{ getFieldError('username') }}
        </small>
      </div>

      <!-- Fecha de Nacimiento -->
      <div class="form-field">
        <label for="fechaNacimiento" class="form-label">Fecha de Nacimiento *</label>
        <p-datepicker
          id="fechaNacimiento"
          formControlName="fechaNacimiento"
          [showIcon]="true"
          dateFormat="dd/mm/yy"
          [maxDate]="maxDate"
          [minDate]="minDate"
          placeholder="dd/mm/aaaa"
        />
        <small
          *ngIf="isFieldInvalid('fechaNacimiento')"
          class="simplified-error"
        >
          {{ getFieldError('fechaNacimiento') }}
        </small>
      </div>

      <!-- Género -->
      <div class="form-field">
        <label for="genero" class="form-label">Género *</label>
        <p-select
          id="genero"
          formControlName="genero"
          [options]="generos"
          optionLabel="label"
          optionValue="value"
          placeholder="Selecciona tu género"
        />
        <small
          *ngIf="isFieldInvalid('genero')"
          class="simplified-error"
        >
          {{ getFieldError('genero') }}
        </small>
      </div>

      <!-- Foto de Perfil -->
      <div class="form-field">
        <label for="fotoPerfil" class="form-label">Foto de Perfil (Opcional)</label>
        <p-fileUpload
          id="fotoPerfil"
          [customUpload]="true"
          [auto]="true"
          [maxFileSize]="2097152"
          accept="image/*"
          [showCancelButton]="false"
          [showUploadButton]="false"
          (onSelect)="onFileSelect($event)"
          chooseLabel="Seleccionar Foto"
          [fileLimit]="1"
        />
        <div class="file-preview" *ngIf="registerForm.get('fotoPerfil')?.value">
          <p-image
            [src]="registerForm.get('fotoPerfil')?.value"
            alt="Vista previa"
            width="100"
            height="100"
            [preview]="true"
            imageClass="preview-image"
          />
        </div>
        <small class="form-help">Formatos aceptados: JPG, PNG, GIF. Máximo 2MB</small>
      </div>

      <!-- Contraseña -->
      <div class="form-field">
        <p-floatlabel>
          <p-password
            id="password"
            formControlName="password"
            [toggleMask]="true"
            [feedback]="true"
          />
          <label for="password">Contraseña</label>
        </p-floatlabel>
        <small
          *ngIf="isFieldInvalid('password')"
          class="simplified-error"
        >
          {{ getFieldError('password') }}
        </small>
      </div>

      <!-- Confirmar Contraseña -->
      <div class="form-field">
        <p-floatlabel>
          <p-password
            id="confirmPassword"
            formControlName="confirmPassword"
            [toggleMask]="true"
            [feedback]="false"
          />
          <label for="confirmPassword">Confirmar Contraseña</label>
        </p-floatlabel>
        <small
          *ngIf="isFieldInvalid('confirmPassword')"
          class="simplified-error"
        >
          {{ getFieldError('confirmPassword') }}
        </small>
      </div>

      <!-- Términos y Condiciones -->
      <div class="form-field">
        <div class="checkbox-container">
          <p-checkbox
            formControlName="acceptTerms"
            inputId="acceptTerms"
            [binary]="true"
          />
          <label for="acceptTerms" class="checkbox-label">
            Acepto los términos y condiciones
          </label>
        </div>
        <small
          *ngIf="isFieldInvalid('acceptTerms')"
          class="simplified-error"
        >
          {{ getFieldError('acceptTerms') }}
        </small>
      </div>

      <!-- Botón de Registro -->
      <div class="form-actions">
        <p-button
          type="submit"
          label="Crear Cuenta"
          [loading]="loading"
          [disabled]="registerForm.invalid"
          styleClass="w-full"
        />
      </div>
    </form>
  </ng-template>

  <ng-template pTemplate="footer">
    <div class="register-footer">
      <p-divider />
      <p-button
        label="¿Ya tienes cuenta? Inicia Sesión"
        link="true"
        (onClick)="onBackToLogin()"
        icon="pi pi-arrow-left"
      />
    </div>
  </ng-template>
</p-card>

<p-toast />
