<!-- Header de la Landing Page -->
<app-header></app-header>

<!-- Contenido del Reset Password -->
<p-card>
  <ng-template pTemplate="header">
    <div class="reset-password-header">
      <h2>Cambiar Contraseña</h2>
      <p *ngIf="!passwordReset">Ingresa tu nueva contraseña</p>
    </div>
  </ng-template>

  <ng-template pTemplate="content">
    <!-- Loading mientras valida token -->
    <app-loading-spinner
      *ngIf="loading && !tokenValid && !passwordReset"
      label="Validando token..."
      size="medium"
      [overlay]="false" />

    <!-- Formulario de nueva contraseña -->
    <div *ngIf="tokenValid && !passwordReset && !loading">
      <form [formGroup]="resetForm" (ngSubmit)="onSubmit()">
        <div class="form-field">
          <p-floatlabel>
            <p-password
              id="password"
              formControlName="password"
              [toggleMask]="true"
              [feedback]="true"
              [class.ng-invalid]="isFieldInvalid('password')"
            />
            <label for="password">Nueva Contraseña</label>
          </p-floatlabel>
          <small
            *ngIf="isFieldInvalid('password')"
            class="p-error"
          >
            {{ getFieldError('password') }}
          </small>
        </div>

        <div class="form-field">
          <p-floatlabel>
            <p-password
              id="confirmPassword"
              formControlName="confirmPassword"
              [toggleMask]="true"
              [feedback]="false"
              [class.ng-invalid]="isFieldInvalid('confirmPassword')"
            />
            <label for="confirmPassword">Confirmar Nueva Contraseña</label>
          </p-floatlabel>
          <small
            *ngIf="isFieldInvalid('confirmPassword')"
            class="p-error"
          >
            {{ getFieldError('confirmPassword') }}
          </small>
        </div>

        <div class="form-actions">
          <p-button
            type="submit"
            label="Cambiar Contraseña"
            [loading]="loading"
            [disabled]="resetForm.invalid"
            styleClass="w-full"
          />
        </div>
      </form>
    </div>

    <!-- Mensaje de éxito -->
    <div *ngIf="passwordReset" class="success-container">
      <div class="success-icon">
        <i class="pi pi-check-circle"></i>
      </div>
      <h3>¡Contraseña Cambiada!</h3>
      <p>
        Tu contraseña ha sido actualizada correctamente.
        Serás redirigido al login en unos segundos.
      </p>
      <p-message
        severity="success"
        text="Ya puedes iniciar sesión con tu nueva contraseña."
      />

      <div class="redirect-section">
        <p-button
          label="Ir al Login Ahora"
          (onClick)="onBackToLogin()"
        />
      </div>
    </div>

    <!-- Error de token inválido -->
    <div *ngIf="!tokenValid && !loading" class="error-container">
      <div class="error-icon">
        <i class="pi pi-times-circle"></i>
      </div>
      <h3>Token Inválido</h3>
      <p>
        El enlace de recuperación ha expirado o no es válido.
        Solicita un nuevo enlace de recuperación.
      </p>
      <p-message
        severity="error"
        text="Por favor, solicita un nuevo enlace desde la página de recuperación."
      />

      <div class="action-buttons">
        <p-button
          label="Solicitar Nuevo Enlace"
          (onClick)="requestNewToken()"
          styleClass="w-full mb-2"
        />
        <p-button
          label="Volver al Login"
          (onClick)="onBackToLogin()"
          styleClass="p-button-text w-full"
        />
      </div>
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <div class="reset-password-footer" *ngIf="tokenValid && !passwordReset">
      <p-button
        label="Volver al Login"
        link="true"
        (onClick)="onBackToLogin()"
        icon="pi pi-arrow-left"
      />
    </div>
  </ng-template>
</p-card>

<!-- Footer de la Landing Page -->
<app-footer></app-footer>

<p-toast />
