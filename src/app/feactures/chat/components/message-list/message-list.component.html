<div class="message-list-container" #messageContainer>
  <!-- Estado de carga -->
  <div *ngIf="loading" class="loading-state">
    <p-progressSpinner size="small" />
    <p>Cargando mensajes...</p>
  </div>

  <!-- Estado sin mensajes -->
  <div *ngIf="!loading && messages.length === 0" class="empty-state">
    <i class="pi pi-comment-slash"></i>
    <h4>{{ emptyStateMessage }}</h4>
    <p>{{ emptyStateSubMessage }}</p>
  </div>

  <!-- Lista de mensajes -->
  <div *ngIf="!loading && messages.length > 0" class="messages-wrapper">
    <ng-container *ngFor="let message of messages; let i = index; trackBy: trackByMessageId">
      <!-- Separador de fecha -->
      <div *ngIf="shouldShowDateSeparator(message, i)" class="date-separator">
        <p-divider align="center">
          <p-chip [label]="formatDateSeparator(message.timestamp)" />
        </p-divider>
      </div>

      <!-- Mensaje -->
      <div class="message-item" [class.own-message]="isOwnMessage(message)">
        <!-- Avatar (solo para mensajes de otros) -->
        <div *ngIf="!isOwnMessage(message)" class="message-avatar">
          <p-avatar
            [label]="getSenderInitials(message.senderName)"
            size="normal"
            shape="circle"
            styleClass="sender-avatar">
          </p-avatar>
        </div>

        <!-- Burbuja del mensaje -->
        <div class="message-bubble" [class.own-bubble]="isOwnMessage(message)">
          <!-- Header del mensaje (solo para mensajes de otros) -->
          <div *ngIf="!isOwnMessage(message)" class="message-header">
            <span class="sender-name">{{ message.senderName }}</span>
          </div>

          <!-- Contenido del mensaje -->
          <div class="message-body">
            <!-- Mensaje de texto -->
            <div *ngIf="message.messageType === 'TEXT'" class="text-content">
              <p>{{ message.content }}</p>
            </div>

            <!-- Mensaje con imagen -->
            <div *ngIf="message.messageType === 'IMAGE'" class="image-content">
              <img [src]="message.content" alt="Imagen compartida" class="message-image" />
            </div>

            <!-- Mensaje con archivo -->
            <div *ngIf="message.messageType === 'FILE'" class="file-content">
              <div class="file-info">
                <i class="pi pi-file file-icon"></i>
                <div class="file-details">
                  <span class="file-name">{{ message.content }}</span>
                  <small class="file-size">Archivo</small>
                </div>
                <p-button
                  icon="pi pi-download"
                  size="small"
                  severity="secondary"
                  [text]="true">
                </p-button>
              </div>
            </div>
          </div>

          <!-- Footer del mensaje -->
          <div class="message-footer">
            <div class="message-meta">
              <small class="message-time">{{ getMessageTime(message) }}</small>

              <!-- Estado del mensaje (solo para mensajes propios) -->
              <div *ngIf="isOwnMessage(message)" class="message-status">
                <i [class]="getMessageStatusIcon(message)" class="status-icon"></i>
                <small>{{ getMessageStatusText(message) }}</small>
              </div>
            </div>

            <!-- Acciones del mensaje -->
            <div class="message-actions" *ngIf="isOwnMessage(message)">
              <p-menu #messageMenu [model]="getMessageActions(message)" [popup]="true">
              </p-menu>

              <p-button
                icon="pi pi-ellipsis-v"
                size="small"
                severity="secondary"
                [text]="true"
                (click)="messageMenu.toggle($event)">
              </p-button>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- BotÃ³n para ir al inicio -->
  <div class="scroll-actions" *ngIf="messages.length > 10">
    <p-button
      icon="pi pi-angle-up"
      (onClick)="scrollToTop()"
      size="small"
      severity="secondary"
      [rounded]="true">
    </p-button>
  </div>
</div>
